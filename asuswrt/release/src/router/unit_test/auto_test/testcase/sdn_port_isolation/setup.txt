SWITCH=DEVICE_0
export sdn_rl="<0>DEFAULT>1>0>0>0>0>0>0>0>0>0>0>0>0>0<0><0>"
export sdn_rl=$sdn_rl"<1>Guest>1>1>1>1>0>0>0>0>0>0>0>0>0>0>0>0<2>Guest>1>2>2>2>0>0>0>0>0>0>0>0>0>0>0>0<3>Guest>1>3>3>3>0>0>0>0>0>0>0>0>0>0>0>0<4>Guest>1>4>4>4>0>0>0>0>0>0>0>0>0>0>0>0<5>Guest>1>5>5>5>0>0>0>0>0>0>0>0>0>0>0>0<6>Guest>1>6>6>6>0>0>0>0>0>0>0>0>0>0>0>0<7>Guest>1>7>7>7>0>0>0>0>0>0>0>0>0>0>0>0<8>Guest>1>8>8>8>0>0>0>0>0>0>0>0>0>0>0>0"
export subnet_rl="<1>br51>192.168.51.1>255.255.255.0>1>192.168.51.2>192.168.51.254>86400>>,>>0>><2>br52>192.168.52.1>255.255.255.0>1>192.168.52.2>192.168.52.254>86400>>,>>0>><3>br53>192.168.53.1>255.255.255.0>1>192.168.53.2>192.168.53.254>86400>>,>>0>><4>br54>192.168.54.1>255.255.255.0>1>192.168.54.2>192.168.54.254>86400>>,>>0>><5>br55>192.168.55.1>255.255.255.0>1>192.168.55.2>192.168.55.254>86400>>,>>0>><6>br56>192.168.56.1>255.255.255.0>1>192.168.56.2>192.168.56.254>86400>>,>>0>><7>br57>192.168.57.1>255.255.255.0>1>192.168.57.2>192.168.57.254>86400>>,>>0>><8>br58>192.168.58.1>255.255.255.0>1>192.168.58.2>192.168.58.254>86400>>,>>0>>"
export subnet_rl=$subnet_rl"<9>br59>192.168.59.1>255.255.255.0>1>192.168.59.2>192.168.59.254>86400>>,>>0>><10>br60>192.168.60.1>255.255.255.0>1>192.168.60.2>192.168.60.254>86400>>,>>0>><11>br61>192.168.61.1>255.255.255.0>1>192.168.61.2>192.168.61.254>86400>>,>>0>><12>br62>192.168.62.1>255.255.255.0>1>192.168.62.2>192.168.62.254>86400>>,>>0>><13>br63>192.168.63.1>255.255.255.0>1>192.168.63.2>192.168.63.254>86400>>,>>0>><14>br64>192.168.64.1>255.255.255.0>1>192.168.64.2>192.168.64.254>86400>>,>>0>><15>br65>192.168.65.1>255.255.255.0>1>192.168.65.2>192.168.65.254>86400>>,>>0>><16>br66>192.168.66.1>255.255.255.0>1>192.168.66.2>192.168.66.254>86400>>,>>0>>"
export subnet_rl=$subnet_rl"<17>br67>192.168.67.1>255.255.255.0>1>192.168.67.2>192.168.67.254>86400>>,>>0>><18>br68>192.168.68.1>255.255.255.0>1>192.168.68.2>192.168.68.254>86400>>,>>0>><19>br69>192.168.69.1>255.255.255.0>1>192.168.69.2>192.168.69.254>86400>>,>>0>><20>br70>192.168.70.1>255.255.255.0>1>192.168.70.2>192.168.70.254>86400>>,>>0>><21>br71>192.168.71.1>255.255.255.0>1>192.168.71.2>192.168.71.254>86400>>,>>0>><22>br72>192.168.72.1>255.255.255.0>1>192.168.72.2>192.168.72.254>86400>>,>>0>><23>br73>192.168.73.1>255.255.255.0>1>192.168.73.2>192.168.73.254>86400>>,>>0>><24>br74>192.168.74.1>255.255.255.0>1>192.168.74.2>192.168.74.254>86400>>,>>0>>"
export subnet_rl=$subnet_rl"<25>br75>192.168.75.1>255.255.255.0>1>192.168.75.2>192.168.75.254>86400>>,>>0>><26>br76>192.168.76.1>255.255.255.0>1>192.168.76.2>192.168.76.254>86400>>,>>0>><27>br77>192.168.77.1>255.255.255.0>1>192.168.77.2>192.168.77.254>86400>>,>>0>><28>br78>192.168.78.1>255.255.255.0>1>192.168.78.2>192.168.78.254>86400>>,>>0>><29>br79>192.168.79.1>255.255.255.0>1>192.168.79.2>192.168.79.254>86400>>,>>0>><30>br80>192.168.80.1>255.255.255.0>1>192.168.80.2>192.168.80.254>86400>>,>>0>><31>br81>192.168.81.1>255.255.255.0>1>192.168.81.2>192.168.81.254>86400>>,>>0>><32>br82>192.168.82.1>255.255.255.0>1>192.168.82.2>192.168.82.254>86400>>,>>0>>"
nvram set sdn_rl=$sdn_rl
nvram set subnet_rl=$subnet_rl
nvram commit
echo "#!/bin/sh" >$HOME/tc-port-isolate.sh
echo -e "get_br_isolated() {\nisolate=0\nf1=/sys/class/net/\$1/brport/isolated\nf2=/sys/class/net/\$1/brport/isolate_mode\nif [ -f \"\$f1\" ]; then\nisolate=\`cat \$f1\`\nelif [ -f \"\$f2\" ]; then\nisolate=\`cat \$f2\`\nelse\nisolate=0\nfi\necho \$isolate\n}\n" >>$HOME/tc-port-isolate.sh
echo -e "get_vlan_isolated() {\nisolated=0\nvid=\$1\nvlan_rl=\`nvram get vlan_rl\`\nlist1=\$(echo \$vlan_rl | tr \"<\" \" \")\nfor i in \$list1\ndo\nlist2=\$(echo \$i | tr \">\" \" \")\nx=1\nfound=0\nfor j in \$list2\ndo\nif [ \$x == \"2\" ]; then\nif [ \$j == \$vid ]; then\nfound=1\nfi\nfi\nif [ \$x == \"3\" ]; then\nif [ \$found == \"1\" ]; then\nisolated=\$j\nbreak\nfi\nfi\nx=\$((\$x+1))\ndone\ndone\necho \$isolated\n}" >>$HOME/tc-port-isolate.sh
echo -e "get_isolated_ifnames() {\nap_rulelist=\`nvram get ap_rulelist\`\nlist1=\$(echo \$ap_rulelist | tr \"<\" \" \")\nfor i in \$list1\ndo\nlist2=\$(echo \$i | tr \">\" \" \")\nx=1\nfound=0\nfor j in \$list2\ndo\nif [ \$x == \"1\" ]; then\nfound=\$(get_vlan_isolated \$j)\nfi\nif [ \$x == \"3\" ]; then\nif [ \$found == \"1\" ]; then\nifnames=\$ifnames\" \"\$j\nfi\nfi\nx=\$((\$x+1))\ndone\ndone\necho \$ifnames\n}" >>$HOME/tc-port-isolate.sh
echo -e "wired_ifnames=\`nvram get wired_ifnames\`\nisolated_ifnames=\$(echo \$(get_isolated_ifnames) | tr \",\" \" \")\nfor i in \$wired_ifnames\ndo\ncc=0\nfor j in \$isolated_ifnames\ndo\nif [ \$i == \$j ]; then\ncc=1\nbreak\nfi\ndone\nif [ \$cc == \"0\" ]; then\nnon_isolate_ifnames=\$non_isolate_ifnames\" \"\$i\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "# check isolated ifnames\ncheck_isolated_result=1\nfor i in \$isolated_ifnames\ndo\nif [ \$(get_br_isolated \$i) != \"1\" ]; then\ncheck_isolated_result=0\nbreak\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "# check non isolate ifnames\ncheck_non_isolate_result=1\nfor i in \$non_isolate_ifnames\ndo\nif [ \$(get_br_isolated \$i) != \"0\" ]; then\ncheck_non_isolate_result=0\nbreak\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "if [[ \$check_isolated_result == \"0\" || \$check_non_isolate_result == \"0\" ]]; then\necho \"NG\"\nelse\necho \"OK\"\nfi" >>$HOME/tc-port-isolate.sh
chmod 777 $HOME/tc-port-isolate.sh
SWITCH=DEVICE_1
echo "#!/bin/sh" >$HOME/tc-port-isolate.sh
echo -e "get_br_isolated() {\nisolate=0\nf1=/sys/class/net/\$1/brport/isolated\nf2=/sys/class/net/\$1/brport/isolate_mode\nif [ -f \"\$f1\" ]; then\nisolate=\`cat \$f1\`\nelif [ -f \"\$f2\" ]; then\nisolate=\`cat \$f2\`\nelse\nisolate=0\nfi\necho \$isolate\n}\n" >>$HOME/tc-port-isolate.sh
echo -e "get_vlan_isolated() {\nisolated=0\nvid=\$1\nvlan_rl=\`nvram get vlan_rl\`\nlist1=\$(echo \$vlan_rl | tr \"<\" \" \")\nfor i in \$list1\ndo\nlist2=\$(echo \$i | tr \">\" \" \")\nx=1\nfound=0\nfor j in \$list2\ndo\nif [ \$x == \"2\" ]; then\nif [ \$j == \$vid ]; then\nfound=1\nfi\nfi\nif [ \$x == \"3\" ]; then\nif [ \$found == \"1\" ]; then\nisolated=\$j\nbreak\nfi\nfi\nx=\$((\$x+1))\ndone\ndone\necho \$isolated\n}" >>$HOME/tc-port-isolate.sh
echo -e "get_isolated_ifnames() {\nap_rulelist=\`nvram get ap_rulelist\`\nlist1=\$(echo \$ap_rulelist | tr \"<\" \" \")\nfor i in \$list1\ndo\nlist2=\$(echo \$i | tr \">\" \" \")\nx=1\nfound=0\nfor j in \$list2\ndo\nif [ \$x == \"1\" ]; then\nfound=\$(get_vlan_isolated \$j)\nfi\nif [ \$x == \"3\" ]; then\nif [ \$found == \"1\" ]; then\nifnames=\$ifnames\" \"\$j\nfi\nfi\nx=\$((\$x+1))\ndone\ndone\necho \$ifnames\n}" >>$HOME/tc-port-isolate.sh
echo -e "wired_ifnames=\`nvram get wired_ifnames\`\nisolated_ifnames=\$(echo \$(get_isolated_ifnames) | tr \",\" \" \")\nfor i in \$wired_ifnames\ndo\ncc=0\nfor j in \$isolated_ifnames\ndo\nif [ \$i == \$j ]; then\ncc=1\nbreak\nfi\ndone\nif [ \$cc == \"0\" ]; then\nnon_isolate_ifnames=\$non_isolate_ifnames\" \"\$i\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "# check isolated ifnames\ncheck_isolated_result=1\nfor i in \$isolated_ifnames\ndo\nif [ \$(get_br_isolated \$i) != \"1\" ]; then\ncheck_isolated_result=0\nbreak\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "# check non isolate ifnames\ncheck_non_isolate_result=1\nfor i in \$non_isolate_ifnames\ndo\nif [ \$(get_br_isolated \$i) != \"0\" ]; then\ncheck_non_isolate_result=0\nbreak\nfi\ndone" >>$HOME/tc-port-isolate.sh
echo -e "if [[ \$check_isolated_result == \"0\" || \$check_non_isolate_result == \"0\" ]]; then\necho \"NG\"\nelse\necho \"OK\"\nfi" >>$HOME/tc-port-isolate.sh
chmod 777 $HOME/tc-port-isolate.sh